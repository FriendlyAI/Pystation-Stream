<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pystation Radio</title>
    <link rel="icon" type="image/png" href="favicon/192.png">
    <link rel="stylesheet" href="css/styles.css">
    <script src="javascript/jquery-3.3.1.min.js"></script>
</head>

<body>
    <audio id="stream" preload="none">
        <source src="http://pystation.mynetgear.com/main.mp3"/>
    </audio>

    <center>
        <h1 id="title">Loading...</h1>
        <input type="button" id="play_button" onclick="play()" value="Play">
        <br>
        <div class="slidecontainer">
            <input type="range" min="0" max="100" value="80" class="slider" id="volume">
        </div>
    </center>

    <script>
        var slider = document.getElementById('volume');
        var stream = document.getElementById('stream');
        stream.volume = slider.value / 100;

        slider.oninput = function() {
            stream.volume = this.value / 100;
        }
    </script>

    <script>
        function play() {
            var stream = document.getElementById('stream');
            var button = document.getElementById('play_button');

            if (stream.paused) {
                stream.load();
                stream.play();
                button.value = 'Pause';
            }

            else {
                stream.pause();
                button.value = 'Play';
            }
        }
    </script>


    <script>
        var stream = document.getElementById('stream');
        var button = document.getElementById('play_button');
        var title = document.getElementById('title');

        function playing_check() {
            setInterval(check_status, 5000);

            function check_status() {
                if (stream.paused) {
                    button.value = 'Play';
                }
                get_title();
            }
        }

        function get_title() {
            fetch('http://pystation.mynetgear.com/status-json.xsl').then(response => {
                return response.json();
            }).then(data => {
                title.textContent = data['icestats']['source']['title'];
            }).catch(err => {
                console.log(err);
            });
        }

        window.onload = playing_check;
    </script>
</body>
</html>